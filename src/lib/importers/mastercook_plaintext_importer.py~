import importer

class mastercook_importer (importer.importer):
    def __init__ (self, rd, file, prog=None, threaded=False):
        importer.importer.__init__(rd,threaded=threaded)
        self.compile_regexps()

    def compile_regexps (self):
        self.rec_start_matcher = re.compile("^\s*\*\s*Exported\s*from\s*MasterCook\s*\*\s*$")
        self.blank_matcher = re.compile("^\s*$")
        self.rec_col_matcher = re.compile("(\s*Amount\s*)(Measure\s*)(Ingredient.*)")
        
        
    def handle_line (self, line):
        rcm=self.rec_col_matcher.match(line):
        if rcm: self.get_ing_cols(rcm)
    
    def get_ing_cols (rcm):
        amt,unit,itm=rcm.groups()
        lamt,lunit,litm = len(amt),len(unit),len(itm)
        self.amt_col = 0,lamt
        self.unit_col = lamt,lamt+lunit
        self.itm_col = lamt+lunit,lamt+lunit+litm
